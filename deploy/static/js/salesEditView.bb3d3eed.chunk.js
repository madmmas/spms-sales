"use strict";(self.webpackChunkspms_app=self.webpackChunkspms_app||[]).push([[6135],{5429:function(e,t,r){r.r(t),r.d(t,{default:function(){return w}});var n=r(4165),a=r(5861),l=r(3433),s=r(9439),o=r(2791),i=r(7689),u=r(9195),c=r(5103),d=r(8218),m=r(7890),f=r(919),h=r(7580),N=r(5854),v=r(4286),p=r(989),x=r(1427),j=r(3956),b=r(3384),y=r(1811),A=r(184),g=function(e){var t=e.customerCategory,r=e.trigger,n=e.netAmount,a=e.onPaymnetSubmit,l={dtPaymentType_id:"CASH",dtBankAccount_id:null,paymentDate:Date.now(),paidAmount:0,dueAmount:0,paymentRef:"",paymentRemarks:""},i=(0,o.useState)(!1),m=(0,s.Z)(i,2),h=m[0],g=(m[1],(0,o.useState)(!1)),C=(0,s.Z)(g,2),S=C[0],P=C[1],F=(0,o.useState)("CASH"),Z=(0,s.Z)(F,2),I=Z[0],k=Z[1],w=(0,u.cI)({defaultValues:l}),K=(w.register,w.control),_=w.formState.errors,R=(w.resetField,w.setValue),D=w.handleSubmit;(0,o.useEffect)((function(){r&&(M(),"WALKIN"===t?(R("dueAmount",0),R("paidAmount",n)):(R("dueAmount",n),R("paidAmount",0)))}),[r]);var M=function(){P(!0)},T=function(e){return _[e]&&(0,A.jsx)("small",{className:"p-error",children:_[e].message})},E=function(){P(!1)},O=(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(f.z,{label:"Cancel",icon:"pi pi-times",className:"p-button-text",onClick:E}),(0,A.jsx)(f.z,{disabled:h,label:"Save",icon:"pi pi-check",className:"p-button-text",onClick:D((function(e){return a(e)}))})]});return(0,A.jsx)(v.V,{visible:S,style:{width:"450px"},header:"Payment",modal:!0,className:"p-fluid",footer:O,onHide:E,children:(0,A.jsxs)("div",{className:"p-fluid formgrid grid",children:[(0,A.jsx)("div",{className:"field col-12 md:col-12",children:(0,A.jsx)(u.Qr,{name:"dtPaymentType_id",control:K,rules:{required:"Payment Type is required."},render:function(e){var t=e.field,r=e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:t.name,className:(0,N.AK)({"p-error":_.value}),children:"Payment Method"}),(0,A.jsx)(x.Z,{field:t,data:b.G4,onSelectChange:function(e){console.log(e),k(e)},className:(0,N.AK)({"p-invalid":r.error})}),T(t.name)]})}})}),(0,A.jsx)("div",{hidden:"BANK"!==I,className:"field col-12 md:col-12",children:(0,A.jsx)(u.Qr,{name:"dtBankAccount_id",control:K,rules:{validate:function(e){return"CASH"===I||"BANK"===I&&null!==e||"Bank Account is required."}},render:function(e){var t=e.field,r=e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:t.name,className:(0,N.AK)({"p-error":_.value}),children:"Bank Name*"}),(0,A.jsx)(j.Z,{field:t,modelName:y.q$,displayField:"accName",showFields:["dtBank_id","accNumber","accName"],onSelect:function(e){console.log(e)},className:(0,N.AK)({"p-invalid":r.error}),columns:[{field:"dtBank_id_shortname",header:"Bank Name",filterPlaceholder:"Filter by Bank Name"},{field:"accNumber",header:"Account Number",filterPlaceholder:"Filter by Account Number"},{field:"accName",header:"Account Name",filterPlaceholder:"Filter by Account Name"}]}),T(t.name)]})}})}),(0,A.jsx)("div",{className:"field col-12 md:col-12",children:(0,A.jsx)(u.Qr,{name:"dueAmount",control:K,rules:{validate:function(e){return e>0||"Enter a valid amount."}},render:function(e){var t=e.field,r=e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:"dueAmount",children:"Due Amount*"}),(0,A.jsx)(p.R,{readOnly:!0,inputId:t.name,value:t.value,inputRef:t.payRef,onValueChange:function(e){return t.onChange(e)},className:(0,N.AK)({"p-invalid":r.error})}),T(t.name)]})}})}),(0,A.jsx)("div",{className:"field col-12 md:col-12",children:(0,A.jsx)(u.Qr,{name:"paidAmount",control:K,rules:{validate:function(e){return e>0||"Enter a valid amount."}},render:function(e){var r=e.field,a=e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:"paidAmount",children:"Pay Amount*"}),(0,A.jsx)(p.R,{inputId:r.name,value:r.value,inputRef:r.payRef,readOnly:"WALKIN"===t,onValueChange:function(e){return function(e){var t=e.target&&e.target.value||0;R("dueAmount",n-t),R("paidAmount",t)}(e)},className:(0,N.AK)({"p-invalid":a.error})}),T(r.name)]})}})}),(0,A.jsx)("div",{className:"field col-12 md:col-12",children:(0,A.jsx)(u.Qr,{name:"paymentRef",control:K,render:function(e){var t=e.field,r=e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:"payRef",children:"Reference"}),(0,A.jsx)(c.o,{inputId:t.name,value:t.value,inputRef:t.payRef,keyfilter:"text",className:(0,N.AK)({"p-invalid":r.error}),onChange:function(e){return t.onChange(e.target.value)},rows:3,cols:20}),T(t.name)]})}})}),(0,A.jsx)("div",{className:"field col-12 md:col-12",children:(0,A.jsx)(u.Qr,{name:"paymentRemarks",control:K,render:function(e){var t=e.field,r=e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:"payRemarks",children:"Remarks*"}),(0,A.jsx)(d.g,{inputId:t.name,value:t.value,inputRef:t.payRef,keyfilter:"text",className:(0,N.AK)({"p-invalid":r.error}),onChange:function(e){return t.onChange(e.target.value)},rows:3,cols:20}),T(t.name)]})}})})]})})},C=r(6008),S=r(9615),P=r(9565),F=r(2486),Z=r(9702),I=r(3130),k=r(1412),w=function(e){var t=e.sales,r=(0,i.s0)(),p={notes:"",dtCustomer_id:"",customerCategory:"WALKIN",customerMobileNumber:"",customerName:""},w={_id:null,dtProduct_id:"",barCode:"",lastSalePrice:0,unitTradePrice:0,quantity:1,totalPrice:0,discount:0,discountedAmount:0,netPrice:0,remarks:""},K=(0,o.useRef)(null),_=(0,o.useState)(0),R=(0,s.Z)(_,2),D=R[0],M=R[1],T=(0,o.useState)(0),E=(0,s.Z)(T,2),O=E[0],W=E[1],B=(0,o.useState)(0),L=(0,s.Z)(B,2),V=L[0],Q=L[1],q=(0,o.useState)(0),z=(0,s.Z)(q,2),H=z[0],X=z[1],G=(0,o.useState)(0),Y=(0,s.Z)(G,2),$=Y[0],J=Y[1],U=(0,o.useState)(0),ee=(0,s.Z)(U,2),te=ee[0],re=ee[1],ne=(0,o.useState)(0),ae=(0,s.Z)(ne,2),le=ae[0],se=ae[1],oe=(0,o.useState)(0),ie=(0,s.Z)(oe,2),ue=ie[0],ce=ie[1],de=(0,o.useState)([]),me=(0,s.Z)(de,2),fe=me[0],he=me[1],Ne=(0,o.useState)({}),ve=(0,s.Z)(Ne,2),pe=ve[0],xe=ve[1],je=(0,o.useState)({}),be=(0,s.Z)(je,2),ye=be[0],Ae=be[1],ge=(0,o.useState)({}),Ce=(0,s.Z)(ge,2),Se=Ce[0],Pe=Ce[1],Fe=(0,o.useState)(w),Ze=(0,s.Z)(Fe,2),Ie=Ze[0],ke=Ze[1],we=(0,o.useState)(!1),Ke=(0,s.Z)(we,2),_e=Ke[0],Re=Ke[1],De=(0,o.useState)(null),Me=(0,s.Z)(De,2),Te=Me[0],Ee=Me[1],Oe=(0,o.useState)("INR"),We=(0,s.Z)(Oe,1)[0],Be=(0,o.useState)("WALKIN"),Le=(0,s.Z)(Be,2),Ve=Le[0],Qe=Le[1],qe=(0,o.useState)(!1),ze=(0,s.Z)(qe,2),He=ze[0],Xe=ze[1],Ge=(0,o.useState)(0),Ye=(0,s.Z)(Ge,2),$e=Ye[0],Je=Ye[1],Ue=(0,o.useState)("XXXXX"),et=(0,s.Z)(Ue,2),tt=et[0],rt=(et[1],new P.p),nt=(new k.e,(0,u.cI)({defaultValues:p})),at=nt.control,lt=nt.formState.errors,st=nt.reset,ot=nt.setValue,it=nt.handleSubmit;(0,o.useEffect)((function(){t&&(ot("dtCustomer_id",t.dtCustomer_id||""),ot("notes",t.notes||""),ot("customerMobileNumber",t.customerMobileNumber||""),ot("customerName",t.customerName||""),he(t.salesItems||[]))}),[]);var ut=function(e,t){e.invoiceDate=Date.now(),e.entryTime=Date.now(),e.servedBy="ADMIN",e.voucherNo=tt,e.customerCategory=Ve,"WALKIN"===Ve?(e.dtCustomer_id=null,e.customerMobileNumber=e.customerMobileNumber,e.customerName=e.customerName,e.customerAddress="",e.salesStatus="COMPLETED"):(console.log("selectedCustomer::",Te),e.dtCustomer_id=Te._id,e.customerMobileNumber=Te.phone,e.customerName=Te.name,e.customerAddress=Te.address,0===t.dueAmount?e.salesStatus="COMPLETED":e.salesStatus="PENDING"),e.items=fe,e.totalQuantity=H,e.totalPrice=D,e.totalDiscount=O,e.totalDiscountedAmount=V,e.deliveryCost=0,e.vat=$,e.netAmount=ue,e.payment=t,e.dueAmount=t.dueAmount,e.isPaid=0===t.dueAmount,e.balanceForward=0,e.netBalance=e.balanceForward+e.dueAmount;try{rt.processTransaction(S.pe,e).then((function(e){K.current.show({severity:"success",summary:"Successful",detail:"Sale Record Created",life:3e3}),r("/sales/"+e.ID)}))}catch(n){K.current.show({severity:"success",summary:"Successful",detail:"Sale Record Created",life:3e3}),r("/sales")}},ct=function(e){return lt[e]&&(0,A.jsx)("small",{className:"p-error",children:lt[e].message})},dt=function(e){se(e);var t=(0,l.Z)(fe);ht(t)},mt=function(e){re(e);var t=(0,l.Z)(fe);ht(t)},ft=function(){ke(w),xe({}),Pe({}),Xe(!1)},ht=function(e){var t,r,n=0,a=0,l=0,s=0;e.forEach((function(e){n+=e.totalPrice,a+=e.discount,l+=e.discountedAmount,s+=e.quantity})),r=n-l+(t=le/100*(n-l))+te,M(n),W(a),Q(l),X(s),J(t),ce(r)},Nt=function(e){console.log(e),ke(e),Pe({_id:e.dtProduct_id}),Xe(!0)},vt=function(e){Ee(e)},pt=function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.value,console.log("selectedCustomer::",Te),null===Te&&"WALKIN"!==Ve){e.next=21;break}if(!He){e.next=6;break}return K.current.show({severity:"warn",summary:"Please Cancel the update",detail:"Product in update",life:3e3}),e.abrupt("return");case 6:if(a=!1,fe.forEach((function(e){e.dtProduct_id===r._id&&(a=!0)})),!a){e.next=14;break}return K.current.show({severity:"warn",summary:"Already Added",detail:"Product Already Added",life:3e3}),Pe({}),xe({}),ke(w),e.abrupt("return");case 14:0,r.lastTradePrice=0,Pe({_id:r._id}),xe(r),e.next=22;break;case 21:K.current.show({severity:"warn",summary:"Please Select Customer",detail:"Select a Customer First",life:3e3});case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xt={first:0,rows:10,page:1,sortField:null,sortOrder:null,filters:{global:{value:null,matchMode:m.a6.CONTAINS},name:{value:null,matchMode:m.a6.CONTAINS},brandName:{value:null,matchMode:m.a6.CONTAINS},modelNo:{value:null,matchMode:m.a6.CONTAINS},partNumber:{value:null,matchMode:m.a6.CONTAINS}}},jt=function(e){Re(!0)},bt=function(){Re(!1)},yt=(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(f.z,{label:"No",icon:"pi pi-times",className:"p-button-text",onClick:bt}),(0,A.jsx)(f.z,{label:"Yes",icon:"pi pi-check",className:"p-button-text",onClick:function(){var e=(0,l.Z)(fe);e.splice(Ie.index,1),he(e),Re(!1)}})]});return(0,A.jsxs)("div",{className:"grid h-screen",children:[(0,A.jsx)(h.F,{ref:K}),(0,A.jsxs)("div",{className:"card col-5",children:[(0,A.jsxs)("h5",{children:["Sale Detail :: VoucherNo (",tt,") "]}),(0,A.jsx)("div",{className:"card col-12 md:col-12",children:(0,A.jsx)(C.Z,{displayField:"name",fieldValue:"",scrollHeight:"300px",defaultFilters:xt,modelName:y.sf,caption:"Select Product",selectedItem:Se,showFields:[],onSelect:pt,columns:[{field:"name",header:"Product Name",filterPlaceholder:"Filter by Product Name",minWidth:"20rem"},{field:"brandName",header:"Brand Name",filterPlaceholder:"Filter by Barnd Name",minWidth:"10rem"},{field:"modelNo",header:"Model No",filterPlaceholder:"Filter by Model No",minWidth:"10rem"},{field:"partNumber",header:"Part Number",filterPlaceholder:"Filter by Part Number",minWidth:"10rem"},{field:"dtProductCategory_id_shortname",header:"Product Category",filterPlaceholder:"Filter by Product Category",minWidth:"10rem"}]})}),(0,A.jsx)("div",{className:"card col-12 md:col-12",children:(0,A.jsxs)("div",{className:"p-fluid formgrid grid",children:[(0,A.jsx)("div",{className:"field col-12 md:col-4",children:(0,A.jsx)(u.Qr,{name:"customerCategory",control:at,render:function(e){var t=e.field,r=e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:t.name,className:(0,N.AK)({"p-error":lt.value}),children:"Customer Category"}),(0,A.jsx)(x.Z,{field:t,data:b.Ey,onSelectChange:function(e){return function(e){Qe(e),"WALKIN"===e&&(Ee({}),ot("dtCustomer_id",""),ot("notes",""),ot("customerMobileNumber",""),ot("customerName",""))}(e)},className:(0,N.AK)({"p-invalid":r.error})}),ct(t.name)]})}})}),(0,A.jsx)("div",{className:"field col-12 md:col-8",children:(0,A.jsx)(u.Qr,{name:"notes",control:at,render:function(e){var t=e.field;e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:t.name,className:(0,N.AK)({"p-error":lt.value}),children:"Notes"}),(0,A.jsx)(d.g,{inputId:t.name,value:t.value,inputRef:t.ref,onChange:function(e){return t.onChange(e.target.value)}})]})}})}),(0,A.jsx)("div",{className:"field col-12 md:col-2",children:(0,A.jsx)(f.z,{type:"submit",label:"Cancel Order",className:"p-button-outlined p-button-warning",onClick:function(){return he([]),M(0),W(0),X(0),J(0),re(0),se(0),ce(0),Qe("WALKIN"),Ee({}),void st(p)}})}),(0,A.jsx)("div",{className:"field col-12 md:col-2",children:(0,A.jsx)(f.z,{type:"submit",label:"Submit Order",className:"p-button p-button-success",onClick:it((function(e){return function(e){if(0!==fe.length)return"CONDITIONAL"!==Ve?(Ae(e),void Je((function(e){return e+1}))):void ut(e,{});K.current.show({severity:"error",summary:"Error",detail:"No Product Added",life:3e3})}(e)}))})}),"WALKIN"===Ve&&(0,A.jsxs)("div",{className:"grid col-12 md:col-8",children:[(0,A.jsx)("div",{className:"field col-12 md:col-6",children:(0,A.jsx)(u.Qr,{name:"customerMobileNumber",control:at,rules:{required:"Mobile Number is required."},render:function(e){var t=e.field;e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:t.name,className:(0,N.AK)({"p-error":lt.value}),children:"Mobile Number"}),(0,A.jsx)(c.o,{inputId:t.name,value:t.value,inputRef:t.ref,onChange:function(e){return t.onChange(e.target.value)}}),ct(t.name)]})}})}),(0,A.jsx)("div",{className:"field col-12 md:col-6",children:(0,A.jsx)(u.Qr,{name:"customerName",control:at,render:function(e){var t=e.field,r=e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:t.name,className:(0,N.AK)({"p-error":lt.value}),children:"Name"}),(0,A.jsx)(c.o,{inputId:t.name,value:t.value,inputRef:t.ref,onChange:function(e){return t.onChange(e.target.value)},className:(0,N.AK)({"p-invalid":r.error})})]})}})})]}),"WALKIN"!==Ve&&(0,A.jsxs)("div",{className:"grid col-12 md:col-8",children:[(0,A.jsx)("div",{className:"field col-12 md:col-8",children:(0,A.jsx)(u.Qr,{name:"dtCustomer_id",control:at,rules:{required:"Custmer is required."},render:function(e){var t=e.field,r=e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:t.name,className:(0,N.AK)({"p-error":lt.value}),children:"Customer*"}),(0,A.jsx)(j.Z,{field:t,modelName:y.CZ,displayField:"name",onSelect:vt,className:(0,N.AK)({"p-invalid":r.error}),columns:[{field:"name",header:"Customer Name",filterPlaceholder:"Filter by Customer Name"}]}),ct(t.name)]})}})}),(0,A.jsxs)("div",{className:"field col-12 md:col-4",children:[(0,A.jsx)("label",{children:"Last Voucher"}),(0,A.jsx)(c.o,{readOnly:!0})]})]})]})})]}),(0,A.jsxs)("div",{className:"card col-7",children:[(0,A.jsx)(F.Z,{onAdd:function(e){return function(e){var t=(0,l.Z)(fe);e.index=fe.length,t.push(e),he(t),ht(t),ft()}(e)},onEdit:function(e){return function(e){var t=(0,l.Z)(fe);t[Ie.index]=e,he(t),ht(t),ft()}(e)},onCancel:function(){return ft()},currency:We,defaultSalesProduct:w,selectedItem:pe,selectedProduct:Ie}),(0,A.jsx)(I.Z,{sales:fe,totalPrice:D,netAmount:ue,totalDiscount:V,vat:$,onVATChange:dt,onDeliveryCostChange:mt,onEdit:function(e){return Nt(e)},onDelete:function(e){return jt()}}),(0,A.jsx)(Z.Z,{sales:fe,totalPrice:D,netAmount:ue,totalDiscount:V,vat:$,onVATChange:dt,onDeliveryCostChange:mt,onEdit:function(e){return Nt(e)},onDelete:function(e){return jt()}}),(0,A.jsx)(v.V,{visible:_e,style:{width:"450px"},header:"Confirm",modal:!0,footer:yt,onHide:bt,children:(0,A.jsxs)("div",{className:"flex align-items-center justify-content-center",children:[(0,A.jsx)("i",{className:"pi pi-exclamation-triangle mr-3",style:{fontSize:"2rem"}}),(0,A.jsx)("span",{children:"Are you sure you want to delete?"})]})}),(0,A.jsx)(g,{customerCategory:Ve,netAmount:ue,onPaymnetSubmit:function(e){ut(ye,e)},trigger:$e,style:{width:"450px"},header:"Payment"})]})]})}}}]);
//# sourceMappingURL=salesEditView.bb3d3eed.chunk.js.map