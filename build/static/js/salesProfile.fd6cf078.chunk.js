"use strict";(self.webpackChunkspms_app=self.webpackChunkspms_app||[]).push([[4900],{9683:function(e,t,r){r.r(t);var a=r(4165),n=r(5861),l=r(1413),s=r(3433),o=r(9439),c=r(2791),i=r(7689),u=r(9195),d=r(5103),m=r(8218),f=r(7890),h=r(919),p=r(7580),v=r(5854),N=r(4286),x=r(1427),y=r(6008),j=r(3956),b=r(3384),C=r(1811),_=r(2486),g=r(9702),S=r(3130),Z=(r(9565),r(1412)),P=r(8998),A=r(184),w=c.memo((function(e){var t=e.sales,r=(0,i.s0)(),w={notes:"",dtCustomer_id:"",customer_category:"WALKIN",customer_phone:"",customer_name:""},F={_id:null,dtProduct_id:"",barCode:"",lastSalePrice:0,unitTradePrice:0,quantity:1,totalPrice:0,discount:0,discountedAmount:0,netPrice:0,remarks:""},I=(0,c.useRef)(null),k=(0,c.useState)(0),K=(0,o.Z)(k,2),E=K[0],L=K[1],M=(0,c.useState)(0),O=(0,o.Z)(M,2),T=O[0],X=O[1],D=(0,c.useState)(0),R=(0,o.Z)(D,2),V=R[0],W=R[1],q=(0,c.useState)(0),z=(0,o.Z)(q,2),Q=(z[0],z[1]),B=(0,c.useState)(0),H=(0,o.Z)(B,2),G=H[0],Y=H[1],J=(0,c.useState)(0),U=(0,o.Z)(J,2),$=U[0],ee=U[1],te=(0,c.useState)(0),re=(0,o.Z)(te,2),ae=re[0],ne=re[1],le=(0,c.useState)(0),se=(0,o.Z)(le,2),oe=se[0],ce=se[1],ie=(0,c.useState)([]),ue=(0,o.Z)(ie,2),de=ue[0],me=ue[1],fe=(0,c.useState)({}),he=(0,o.Z)(fe,2),pe=he[0],ve=he[1],Ne=(0,c.useState)({}),xe=(0,o.Z)(Ne,2),ye=xe[0],je=xe[1],be=(0,c.useState)(F),Ce=(0,o.Z)(be,2),_e=Ce[0],ge=Ce[1],Se=(0,c.useState)(!1),Ze=(0,o.Z)(Se,2),Pe=Ze[0],Ae=Ze[1],we=(0,c.useState)(null),Fe=(0,o.Z)(we,2),Ie=Fe[0],ke=Fe[1],Ke=(0,c.useState)("INR"),Ee=(0,o.Z)(Ke,1)[0],Le=(0,c.useState)("WALKIN"),Me=(0,o.Z)(Le,2),Oe=Me[0],Te=Me[1],Xe=(0,c.useState)(!1),De=(0,o.Z)(Xe,2),Re=De[0],Ve=De[1],We=(0,c.useState)("XXXXX"),qe=(0,o.Z)(We,2),ze=qe[0],Qe=qe[1],Be=(0,c.useState)(""),He=(0,o.Z)(Be,2),Ge=(He[0],He[1],(0,c.useState)("draft")),Ye=(0,o.Z)(Ge,2),Je=Ye[0],Ue=(Ye[1],(0,c.useState)(!0)),$e=(0,o.Z)(Ue,2),et=($e[0],$e[1]),tt=new P.p,rt=new Z.e,at=(0,u.cI)({defaultValues:w}),nt=at.control,lt=at.formState.errors,st=at.reset,ot=at.setValue,ct=at.handleSubmit;(0,c.useEffect)((function(){null===t||void 0===t?"XXXXX"===ze&&rt.getNextId(C.Id).then((function(e){Qe(e.nextID)})):(st({id:t.id,party_type:t.party_type,dtCustomer_id:t.party_id,customer_category:t.customer_category,customer_phone:t.customer_phone,customer_name:t.customer_name,notes:t.notes}),me(t.items),ft(t.items),Qe(t.voucher_no),et("draft"===t.status))}),[t]);var it=function(e){return lt[e]&&(0,A.jsx)("small",{className:"p-error",children:lt[e].message})},ut=function(e){ne(e);var t=(0,s.Z)(de);ft(t)},dt=function(e){ee(e);var t=(0,s.Z)(de);ft(t)},mt=function(){ge(F),ve({}),je({}),Ve(!1)},ft=function(e){var t,r,a=0,n=0,l=0,s=0;e.forEach((function(e){a+=e.totalPrice,n+=e.discount,l+=e.discountedAmount,s+=e.quantity})),r=a-l+(t=ae/100*(a-l))+$,L(a),X(n),W(l),Q(s),Y(t),ce(r)},ht=function(e){console.log(e),ge((0,l.Z)({},e)),je({id:e.dtProduct_id}),Ve(!0)},pt=function(e){ke(e)},vt=function(){var e=(0,n.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.value,console.log("selectedCustomer::",Ie),null===Ie&&"WALKIN"!==Oe){e.next=21;break}if(!Re){e.next=6;break}return I.current.show({severity:"warn",summary:"Please Cancel the update",detail:"Product in update",life:3e3}),e.abrupt("return");case 6:if(n=!1,de.forEach((function(e){e.dtProduct_id===r.id&&(n=!0)})),!n){e.next=14;break}return I.current.show({severity:"warn",summary:"Already Added",detail:"Product Already Added",life:3e3}),je({}),ve({}),ge(F),e.abrupt("return");case 14:0,r.lastTradePrice=0,je({id:r.id}),ve(r),e.next=22;break;case 21:I.current.show({severity:"warn",summary:"Please Select Customer",detail:"Select a Customer First",life:3e3});case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Nt={fields:["id","name","code","bar_code","brand_name","model_no","part_number","current_stock","price"],first:0,rows:10,page:1,sortField:null,sortOrder:null,filters:{global:{value:null,matchMode:f.a6.CONTAINS},name:{value:null,matchMode:f.a6.CONTAINS},brandName:{value:null,matchMode:f.a6.CONTAINS},modelNo:{value:null,matchMode:f.a6.CONTAINS},partNumber:{value:null,matchMode:f.a6.CONTAINS}}},xt=function(e){Ae(!0)},yt=function(){Ae(!1)},jt=(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(h.z,{label:"No",icon:"pi pi-times",className:"p-button-text",onClick:yt}),(0,A.jsx)(h.z,{label:"Yes",icon:"pi pi-check",className:"p-button-text",onClick:function(){var e=(0,s.Z)(de);e.splice(_e.index,1),me(e),Ae(!1)}})]});return(0,A.jsxs)("div",{className:"grid h-screen",children:[(0,A.jsx)(p.F,{ref:I}),(0,A.jsxs)("div",{className:"card col-5",children:[(0,A.jsxs)("h5",{children:[(0,A.jsx)(h.z,{onClick:function(){r("/sales")},className:"p-button-outlined",label:"Go Back"})," Sale Detail :: VoucherNo (",ze,") "]}),(0,A.jsx)("div",{className:"card col-12 md:col-12",children:(0,A.jsx)(y.Z,{displayField:"name",fieldValue:"",scrollHeight:"300px",defaultFilters:Nt,modelName:C.sf,caption:"Select Product",selectedItem:ye,showFields:[],onSelect:vt,columns:[{field:"name",header:"Product Name",filterPlaceholder:"Filter by Product Name",width:"50rem"},{field:"brand_name",header:"Brand Name",filterPlaceholder:"Filter by Barnd Name",width:"15rem"},{field:"model_no",header:"Model No",filterPlaceholder:"Filter by Model No",width:"15rem"},{field:"part_number",header:"Part Number",filterPlaceholder:"Filter by Part Number",width:"15rem"},{field:"category_name",header:"Product Category",filterPlaceholder:"Filter by Product Category",width:"15rem"}]})}),(0,A.jsx)("div",{className:"card col-12 md:col-12",children:(0,A.jsxs)("div",{className:"p-fluid formgrid grid",children:[(0,A.jsx)("div",{className:"field col-12 md:col-4",children:(0,A.jsx)(u.Qr,{name:"customer_category",control:nt,render:function(e){var t=e.field,r=e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:t.name,className:(0,v.AK)({"p-error":lt.value}),children:"Customer Category"}),(0,A.jsx)(x.Z,{field:t,data:b.Ey,onSelectChange:function(e){return function(e){Te(e),"WALKIN"===e&&(ke({}),ot("dtCustomer_id",""),ot("notes",""),ot("customer_phone",""),ot("customer_name",""))}(e)},className:(0,v.AK)({"p-invalid":r.error})}),it(t.name)]})}})}),(0,A.jsx)("div",{className:"field col-12 md:col-8",children:(0,A.jsx)(u.Qr,{name:"notes",control:nt,render:function(e){var t=e.field;e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:t.name,className:(0,v.AK)({"p-error":lt.value}),children:"Notes"}),(0,A.jsx)(m.g,{inputId:t.name,value:t.value,inputRef:t.ref,onChange:function(e){return t.onChange(e.target.value)}})]})}})}),(0,A.jsx)("div",{className:"field col-12 md:col-2",children:(0,A.jsx)(h.z,{type:"submit",label:"Cancel Order",className:"p-button-outlined p-button-warning",onClick:function(){return me([]),L(0),X(0),Q(0),Y(0),ee(0),ne(0),ce(0),Te("WALKIN"),ke({}),void st(w)}})}),(0,A.jsx)("div",{className:"field col-12 md:col-2",children:(0,A.jsx)(h.z,{type:"submit",label:"Save Order",className:"p-button p-button-success",onClick:ct((function(e){return function(e){if(0!==de.length){e.status=Je,e.voucher_no=ze,"WALKIN"===Oe?(e.party_type=" ",e.party_id=" ",e.customer_phone=e.customer_phone,e.customer_name=e.customer_name,e.salesStatus="COMPLETED"):(e.party_type="dtCustomer",e.party_id=Ie._id,e.customer_phone=Ie.phone,e.customer_name=Ie.name),e.items=de,e.gross=E,e.discount=T,e.duty_vat=G,e.net=oe,e.due=oe,e.paid=0;try{t?tt.update(C.Id,t.id,e).then((function(e){I.current.show({severity:"success",summary:"Successful",detail:"Purchase Record Created",life:3e3})})):tt.create(C.Id,e).then((function(e){I.current.show({severity:"success",summary:"Successful",detail:"Purchase Record Created",life:3e3})}))}catch(r){console.log(r),I.current.show({severity:"error",summary:"Error",detail:"Failed to create Purchase Record!",life:3e3})}}else I.current.show({severity:"error",summary:"Error",detail:"No Product Added",life:3e3})}(e)}))})}),"WALKIN"===Oe&&(0,A.jsxs)("div",{className:"grid col-12 md:col-8",children:[(0,A.jsx)("div",{className:"field col-12 md:col-6",children:(0,A.jsx)(u.Qr,{name:"customer_phone",control:nt,rules:{required:"Mobile Number is required."},render:function(e){var t=e.field;e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:t.name,className:(0,v.AK)({"p-error":lt.value}),children:"Mobile Number"}),(0,A.jsx)(d.o,{inputId:t.name,value:t.value,inputRef:t.ref,onChange:function(e){return t.onChange(e.target.value)}}),it(t.name)]})}})}),(0,A.jsx)("div",{className:"field col-12 md:col-6",children:(0,A.jsx)(u.Qr,{name:"customer_name",control:nt,render:function(e){var t=e.field,r=e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:t.name,className:(0,v.AK)({"p-error":lt.value}),children:"Name"}),(0,A.jsx)(d.o,{inputId:t.name,value:t.value,inputRef:t.ref,onChange:function(e){return t.onChange(e.target.value)},className:(0,v.AK)({"p-invalid":r.error})})]})}})})]}),"WALKIN"!==Oe&&(0,A.jsxs)("div",{className:"grid col-12 md:col-8",children:[(0,A.jsx)("div",{className:"field col-12 md:col-8",children:(0,A.jsx)(u.Qr,{name:"dtCustomer_id",control:nt,rules:{required:"Custmer is required."},render:function(e){var t=e.field,r=e.fieldState;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("label",{htmlFor:t.name,className:(0,v.AK)({"p-error":lt.value}),children:"Customer*"}),(0,A.jsx)(j.Z,{field:t,modelName:C.CZ,displayField:"name",onSelect:pt,className:(0,v.AK)({"p-invalid":r.error}),columns:[{field:"name",header:"Customer Name",filterPlaceholder:"Filter by Customer Name"}]}),it(t.name)]})}})}),(0,A.jsxs)("div",{className:"field col-12 md:col-4",children:[(0,A.jsx)("label",{children:"Last Voucher"}),(0,A.jsx)(d.o,{readOnly:!0})]})]})]})})]}),(0,A.jsxs)("div",{className:"card col-7",children:[(0,A.jsx)(_.Z,{onAdd:function(e){return function(e){var t=(0,s.Z)(de);e.index=de.length,t.push(e),me(t),ft(t),mt()}(e)},onEdit:function(e){return function(e){var t=(0,s.Z)(de);t[_e.index]=e,me(t),ft(t),mt()}(e)},onCancel:function(){return mt()},currency:Ee,defaultSalesProduct:F,selectedItem:pe,selectedProduct:_e}),(0,A.jsx)(S.Z,{sales:de,totalPrice:E,netAmount:oe,totalDiscount:V,vat:G,onVATChange:ut,onDeliveryCostChange:dt,onEdit:function(e){return ht(e)},onDelete:function(e){return xt()}}),(0,A.jsx)(g.Z,{sales:de,totalPrice:E,netAmount:oe,totalDiscount:V,vat:G,onVATChange:ut,onDeliveryCostChange:dt,onEdit:function(e){return ht(e)},onDelete:function(e){return xt()}}),(0,A.jsx)(N.V,{visible:Pe,style:{width:"450px"},header:"Confirm",modal:!0,footer:jt,onHide:yt,children:(0,A.jsxs)("div",{className:"flex align-items-center justify-content-center",children:[(0,A.jsx)("i",{className:"pi pi-exclamation-triangle mr-3",style:{fontSize:"2rem"}}),(0,A.jsx)("span",{children:"Are you sure you want to delete?"})]})})]})]})}));t.default=w}}]);
//# sourceMappingURL=salesProfile.fd6cf078.chunk.js.map